#!/bin/sh
# Debian postinstall script
#
# see: dh_installdeb(1)
set -e
case "$1" in
	configure)
		sbindir=/usr/bin
		vardir=/var/lib/ipmiutil
		sensorout=$vardir/sensor_out.txt

		mkdir -p $vardir

		# Run some ipmiutil command to see if any IPMI interface works.
		IPMIcmd=true
		$sbindir/ipmiutil sel -v >/dev/null 2>&1 || IPMIcmd=false

		# If IPMIcmd is still true, then the IPMI command was successful, and IPMI is enabled locally.
		if $IPMIcmd ; then
			# Capture a snapshot of IPMI sensor data once now for later reuse.
			if [ ! -f $sensorout ]; then
				$sbindir/ipmiutil sensor -q >$sensorout
			fi
		fi
	;;

	abort-upgrade|abort-remove|abort-deconfigure)
	;;

	*)
		echo "postinst called with unknown argument \`$1'" >&2
		exit 1
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
